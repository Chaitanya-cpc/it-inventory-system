{% extends 'base.html' %}
{% from "_form_helpers.html" import render_field %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Hardware: {{ asset.name }}</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{{ url_for('main.hardware_edit', asset_id=asset.id) }}" class="btn btn-warning me-2">
             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.793l-2.03-2.03L13.52.692a.5.5 0 0 1 .707 0l1.273 1.248zm-4.386 3.251l-2.03-2.03L.99 8.716a.5.5 0 0 0 0 .707l2.03 2.03a.5.5 0 0 0 .707 0L11.116 5.19z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/></svg>
            Edit Hardware
        </a>
        <form action="{{ url_for('main.hardware_delete', asset_id=asset.id) }}" method="post" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete asset \'{{ asset.name }}\'? This cannot be undone.');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button type="submit" class="btn btn-danger">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16"><path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm2.983-.01a.5.5 0 0 1 .55.466l.5 8.5a.5.5 0 1 1-.998 0l-.5-8.5a.5.5 0 0 1 .448-.504Zm2.993.01a.5.5 0 0 1 .533.46l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .465-.512Z"/></svg>
                Delete Hardware
            </button>
        </form>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <h4>Hardware Details</h4>
        <dl class="row">
            <dt class="col-sm-4">ID</dt><dd class="col-sm-8">{{ asset.id }}</dd>
            <dt class="col-sm-4">Category</dt><dd class="col-sm-8">{{ asset.category or 'N/A' }}{% if asset.sub_category %} ({{ asset.sub_category }}){% endif %}</dd>
            <dt class="col-sm-4">Status</dt><dd class="col-sm-8"><span class="badge bg-{{ 'success' if asset.status == 'Okay' or asset.status == 'Deployed' else 'secondary' if asset.status == 'New' or asset.status == 'Stored' else 'warning' if asset.status == 'Needs Repair' else 'danger' if asset.status == 'Dead' else 'light' }}">{{ asset.status or 'N/A' }}</span></dd>
            <dt class="col-sm-4">Model</dt><dd class="col-sm-8">{{ asset.model or 'N/A' }}</dd>
            <dt class="col-sm-4">Serial Number</dt><dd class="col-sm-8">{{ asset.serial_number or 'N/A' }}</dd>
            <dt class="col-sm-4">Purchase Date</dt><dd class="col-sm-8">{{ asset.purchase_date.strftime('%Y-%m-%d') if asset.purchase_date else 'N/A' }}</dd>
            <dt class="col-sm-4">Acquisition</dt><dd class="col-sm-8">{{ asset.acquisition_type or 'N/A' }}</dd>
            <dt class="col-sm-4">Assigned User</dt><dd class="col-sm-8">{{ asset.assigned_user or 'N/A' }}</dd>
            <dt class="col-sm-4">Location</dt><dd class="col-sm-8">{{ asset.location or 'N/A' }}</dd>
            <dt class="col-sm-4">Notes</dt><dd class="col-sm-8">{{ asset.notes or 'N/A' }}</dd>
            <dt class="col-sm-4">Created</dt><dd class="col-sm-8">{{ asset.created_at.strftime('%Y-%m-%d %H:%M') if asset.created_at else 'N/A' }}</dd>
             <dt class="col-sm-4">Last Updated</dt><dd class="col-sm-8">{{ asset.updated_at.strftime('%Y-%m-%d %H:%M') if asset.updated_at else 'N/A' }}</dd>
        </dl>
    </div>
    <div class="col-md-6">
        <h4>Associated Information</h4>
        {% if infos %}
        <div class="list-group mb-3">
            {% for info in infos %}
            <div class="list-group-item list-group-item-action flex-column align-items-start">
                <div class="d-flex w-100 justify-content-between">
                  <h5 class="mb-1">{{ info.name }} <small class="text-muted">({{ info.info_type }})</small></h5>
                  <small>ID: {{ info.id }}</small>
                </div>
                 {% if info.details %}<p class="mb-1">Details: {{ info.details }}</p>{% endif %}
                 {% if info.license_key %}<p class="mb-1">Key: {{ info.license_key }}</p>{% endif %}
                 {% if info.activation_date or info.expiry_date %}
                   <p class="mb-1">
                       {% if info.activation_date %}Activated: {{ info.activation_date.strftime('%Y-%m-%d') }}{% endif %}
                       {% if info.activation_date and info.expiry_date %} | {% endif %}
                       {% if info.expiry_date %}Expires: {{ info.expiry_date.strftime('%Y-%m-%d') }}{% endif %}
                   </p>
                 {% endif %}
                {% if info.notes %}<p class="mb-1">Notes: {{ info.notes }}</p>{% endif %}
                <small class="text-muted">Last Updated: {{ info.updated_at.strftime('%Y-%m-%d %H:%M') if info.updated_at else 'N/A' }}</small>
                <div class="mt-2">
                    <a href="{{ url_for('main.info_edit', info_id=info.id) }}" class="btn btn-sm btn-outline-secondary">Edit Info</a>
                    <form action="{{ url_for('main.info_delete', info_id=info.id) }}" method="post" style="display: inline;" onsubmit="return confirm('Delete info \'{{ info.name }}\'?');">
                       <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                       <button type="submit" class="btn btn-sm btn-outline-danger">Delete Info</button>
                    </form>
                </div>
              </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No associated information found for this asset.</p>
        {% endif %}

        <hr>
        <h5>Add New Information</h5>
         <form method="post" action="{{ url_for('main.info_add', asset_id=asset.id) }}">
            {{ info_form.hidden_tag() }} {# CSRF + hardware_asset_id hidden field #}
            {{ render_field(info_form.info_type) }}
            {{ render_field(info_form.name) }}
            {{ render_field(info_form.details) }}
            {{ render_field(info_form.license_key) }}
            <div class="row">
                <div class="col-md-6">{{ render_field(info_form.activation_date) }}</div>
                <div class="col-md-6">{{ render_field(info_form.expiry_date) }}</div>
            </div>
             {{ render_field(info_form.notes) }}
             {{ info_form.submit(class="btn btn-primary") }}
        </form>
    </div>
</div>


{% endblock %}